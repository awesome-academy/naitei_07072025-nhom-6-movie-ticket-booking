<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="#{menu.manager.cinemas}">Quản lý Rạp</title>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #0d6efd;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        main {
            flex: 1;
            padding: 2rem;
        }
        footer {
            background-color: #f8f9fa;
            text-align: center;
            padding: 1rem;
            border-top: 1px solid #dee2e6;
        }
        .card:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h2 th:text="#{menu.manager.cinemas}">Quản lý Rạp</h2>
<main class="container">
    <div class="row mb-4">
        <div class="col-md-4">
            <label for="cinemaSelect" class="form-label fw-bold" th:text="#{menu.manager.listCinemas}">Chọn rạp bạn quản lý:</label>
            <select id="cinemaSelect" class="form-select">
                <option value="" selected disabled th:text="#{menu.manager.selectCinema}">-- Chọn rạp --</option>
                <option th:each="cinema : ${cinemas}"
                        th:value="${cinema.id}"
                        th:text="${cinema.name}">
                </option>
            </select>
        </div>
    </div>
    <form th:action="@{/rooms/import}" method="post" enctype="multipart/form-data">
        <div class="col-md-4">
            <label for="file" class="form-label" th:text="#{menu.manager.selectFile}">Chọn file:</label>
            <input type="file" class="form-control" id="file" name="file" required>
        </div>

        <button style="margin-top: 24px" type="submit" class="btn btn-primary">Import</button>
    </form>

    <div class="row" id="roomsContainer"></div>
</main>

<script src="bootstrap/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
        const cinemaSelect = document.getElementById("cinemaSelect");
        const roomsContainer = document.getElementById("roomsContainer");

        // Khi chọn rạp, fetch danh sách phòng chiếu
        cinemaSelect.addEventListener("change", function () {
            const cinemaId = this.value;
            if (!cinemaId) return;

            roomsContainer.innerHTML = '';

            fetch(`/manager/${cinemaId}/rooms`)
                .then(res => res.json())
                .then(rooms => {
                    if (!rooms || rooms.length === 0) {
                        roomsContainer.innerHTML = '<p style="margin-top: 24px" class="text-secondary">Chưa có phòng chiếu cho rạp này.</p>';
                        return;
                    }
                    rooms.forEach(room => {
                        const cardCol = document.createElement("div");
                        cardCol.className = "col-md-4 mb-4";
                        cardCol.innerHTML = `
                            <div class="card h-100" style="cursor:pointer;" onclick="window.location.href='/rooms/${room.id}/seats'">
                                <div class="card-body">
                                    <h5 class="card-title">${room.name}</h5>
                                    <p class="card-text">Số ghế: ${room.quantitySeats}</p>
                                </div>
                            </div>`;
                        roomsContainer.appendChild(cardCol);
                    });
                })
                .catch(err => console.error("Lỗi fetch phòng chiếu:", err));
        });
    /*]]>*/
</script>
</body>
</html>
