<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<body>
<div th:fragment="content">
    <div class="container-fluid px-0">
        <h6 class="text-muted mb-3">Dashboard / <span th:text="#{movie.list}">Danh Sách Phim</span></h6>

        <!-- Filter buttons -->
        <div class="mb-3 d-flex gap-2">
            <a th:href="@{/manager/movies(filter='all')}"
               class="btn btn-sm"
               th:classappend="${filter == 'all'} ? 'btn-info' : 'btn-outline-info'"
               th:text="#{movie.filter.all}">Tất cả phim</a>

            <a th:href="@{/manager/movies(filter='selected')}"
               class="btn btn-sm"
               th:classappend="${filter == 'selected'} ? 'btn-info' : 'btn-outline-info'"
               th:text="#{movie.filter.selected}">Phim đã thêm vào rạp</a>

            <a th:href="@{/manager/movies(filter='unselected')}"
               class="btn btn-sm"
               th:classappend="${filter == 'unselected'} ? 'btn-info' : 'btn-outline-info'"
               th:text="#{movie.filter.unselected}">Phim chưa thêm vào rạp</a>
        </div>

        <!-- Table -->
        <div class="table-responsive rounded-3 overflow-hidden">
            <table class="table align-middle mb-0">
                <thead class="table-light" style="font-weight:600;">
                <tr>
                    <th th:text="#{movie.title}">Tên phim</th>
                    <th th:text="#{movie.year}">Năm phát hành</th>
                    <th th:text="#{movie.genre}">Thể loại</th>
                    <th th:text="#{movie.schedule}">Lịch chiếu</th>
                    <th th:text="#{movie.status}">Trạng thái</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="m : ${movies}">
                    <td th:text="${m.title}">Tên phim</td>
                    <td th:text="${m.releaseDate != null ? m.releaseDate.getYear() : ''}">2025</td>

                    <!-- genres -->
                    <td>
                        <span th:if="${m.genres != null}">
                            <span th:each="g, it : ${m.genres}"
                                  th:text="${g.name}"
                                  th:append="${!it.last} ? ', ' : ''">Thể loại</span>
                        </span>
                    </td>

                    <!-- schedule -->
                    <td th:text="${m.releaseDate != null ? #temporals.format(m.releaseDate, 'dd/MM/yyyy') : '-'}">18/08/2025</td>

                    <td>
                        <button th:if="${selectedMovieIds.contains(m.id)}"
                                class="btn btn-sm btn-secondary rounded-pill px-3"
                                th:text="#{movie.status.added}">Đã thêm</button>

                        <form th:if="${!selectedMovieIds.contains(m.id)}"
                              th:action="@{/manager/movies/{id}/add(id=${m.id})}"
                              method="post" class="d-inline">
                            <input type="hidden" name="filter" th:value="${filter}">
                            <button type="submit"
                                    class="btn btn-sm btn-info rounded-pill px-3"
                                    th:text="#{movie.status.add}">Thêm vào rạp</button>
                        </form>
                    </td>
                </tr>

                <!-- Empty case -->
                <tr th:if="${#lists.isEmpty(movies)}">
                    <td colspan="5" class="text-center text-muted py-4"
                        th:text="#{movie.empty}">Không có phim nào để hiển thị.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>