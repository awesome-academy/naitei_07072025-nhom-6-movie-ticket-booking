<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
      th:replace="CinemaManager/layoutManager :: content">
<head>
    <title th:text="#{movie.list}">Danh sách phim</title>

    <th:block th:fragment="styles">
        <link th:href="@{/css/movies.css}" rel="stylesheet"/>
    </th:block>
</head>
<body>
<div th:fragment="content">
    <h6 class="text-muted mb-3">
        Dashboard / <span th:text="#{movie.list}">Danh Sách Phim</span>
    </h6>

    <!-- Form lọc -->
    <form method="get" th:action="@{/manager/movies}" class="filter-form mb-3 d-flex gap-2">
        <select name="cinemaId" class="form-select form-select-sm">
            <option th:value="" th:text="#{cinema.choose}">-- Chọn rạp --</option>
            <option th:each="c : ${cinemas}"
                    th:value="${c.id}"
                    th:selected="${c.id == cinemaId}"
                    th:text="${c.name}"></option>
        </select>
        <select name="filter" class="form-select form-select-sm">
            <option value="all" th:selected="${filter=='all'}"
                    th:text="#{movie.filter.all}">Tất cả phim</option>
            <option value="selected" th:selected="${filter=='selected'}"
                    th:text="#{movie.filter.selected}">Phim đã thêm</option>
            <option value="unselected" th:selected="${filter=='unselected'}"
                    th:text="#{movie.filter.unselected}">Phim chưa thêm</option>
        </select>
        <button type="submit" class="btn btn-sm btn-info px-3"
                th:text="#{button.view}">Xem</button>
    </form>

    <!-- Bảng phim -->
    <div class="table-responsive rounded-3 overflow-hidden shadow-sm">
        <table class="table align-middle mb-0">
            <thead class="table-dark">
            <tr>
                <th th:text="#{movie.title}">Tên phim</th>
                <th th:text="#{movie.year}">Năm</th>
                <th th:text="#{movie.genre}">Thể loại</th>
                <th th:text="#{movie.schedule}">Lịch chiếu</th>
                <th th:text="#{movie.status}">Trạng thái</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="m : ${movies.content}">
                <td th:text="${m.title}"></td>
                <td th:text="${m.releaseDate != null ? #temporals.format(m.releaseDate, 'yyyy') : ''}"></td>
                <td>
                    <span th:each="g, it : ${m.genres}"
                          th:text="${g.name}"
                          th:append="${!it.last} ? ', ' : ''"
                          class="genre-tag"></span>
                </td>
                <td th:text="${m.releaseDate != null ? #temporals.format(m.releaseDate,'dd/MM/yyyy') : '-'}"></td>
                <td>
                    <button th:if="${selectedMovieIds.contains(m.id)}"
                            class="btn btn-sm btn-secondary px-3"
                            th:text="#{movie.added}">Đã thêm</button>
                    <form th:if="${!selectedMovieIds.contains(m.id)}"
                          th:action="@{/manager/movies/add}"
                          method="post" class="d-inline">
                        <input type="hidden" name="cinemaId" th:value="${cinemaId}">
                        <input type="hidden" name="movieId" th:value="${m.id}">
                        <button type="submit" class="btn btn-sm btn-info px-3"
                                th:text="#{movie.add.to.cinema}">Thêm vào rạp</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${movies.empty}">
                <td colspan="5" class="text-center text-muted py-4"
                    th:text="#{movie.empty}">Không có phim nào để hiển thị.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div th:if="${movies.totalPages > 1}" class="mt-4 d-flex justify-content-center">
        <nav>
            <ul class="pagination pagination-sm">
                <li class="page-item" th:classappend="${movies.first}? 'disabled'">
                    <a class="page-link"
                       th:href="@{/manager/movies(cinemaId=${cinemaId}, filter=${filter}, page=${movies.number - 1})}">&laquo;</a>
                </li>
                <li th:each="p : ${#numbers.sequence(0, movies.totalPages-1)}"
                    class="page-item"
                    th:classappend="${p == movies.number}? 'active'">
                    <a class="page-link"
                       th:href="@{/manager/movies(cinemaId=${cinemaId}, filter=${filter}, page=${p})}"
                       th:text="${p + 1}"></a>
                </li>
                <li class="page-item" th:classappend="${movies.last}? 'disabled'">
                    <a class="page-link"
                       th:href="@{/manager/movies(cinemaId=${cinemaId}, filter=${filter}, page=${movies.number + 1})}">&raquo;</a>
                </li>
            </ul>
        </nav>
    </div>
</div>
</body>
</html>
